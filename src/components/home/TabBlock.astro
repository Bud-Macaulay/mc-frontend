---
import {
  Info,
  Globe,
  Newspaper,
  BarChart2,
  Users,
  FileText,
} from "lucide-astro";

import Vision from "./tabcontent/Vision.astro";
import News from "./tabcontent/News.astro";

import DMP from "./tabcontent/OSandDMPs.astro";
import Statistics from "./tabcontent/Statistics.astro";
import Partners from "./tabcontent/Partners.astro";

const tabs = [
  { id: "vision", label: "Vision", Icon: Info, Content: Vision },
  { id: "news", label: "News", Icon: Globe, Content: News },
  { id: "dmp", label: "DMP", Icon: FileText, Content: DMP },
  {
    id: "statistics",
    label: "Statistics",
    Icon: BarChart2,
    Content: Statistics,
  },
  { id: "partners", label: "Partners", Icon: Users, Content: Partners },
];

const buttonStyle = `
  flex flex-1 flex-col items-center justify-center py-2
  font-semibold text-[#3E70BB]
  cursor-pointer
  transition-colors
  border-b border-gray-300 last:border-b-0
  sm:border-none sm:border-r sm:last:border-r-0
  aria-selected:text-red-600
  aria-selected:cursor-default
  not-aria-selected:hover:text-blue-500
  not-aria-selected:hover:bg-gradient-to-t 
  not-aria-selected:hover:from-slate-100 
  not-aria-selected:hover:to-white
`;
---

<!-- script handler manages tab selection -->
<script type="module">
  let activeTab = window.location.hash
    ? window.location.hash.substring(1)
    : null;

  let validTabs = [];

  function selectTab(tab, updateHash = true) {
    activeTab = tab;
    document.querySelectorAll('[role="tab"]').forEach((btn) => {
      btn.setAttribute(
        "aria-selected",
        btn.dataset.tab === tab ? "true" : "false"
      );
    });
    document.querySelectorAll('[role="tabpanel"]').forEach((panel) => {
      if (panel.id === `panel-${tab}`) {
        panel.classList.remove("hidden");
      } else {
        panel.classList.add("hidden");
      }
    });

    if (updateHash) {
      history.replaceState(null, "", `#${tab}`);
    }
  }

  window.addEventListener("DOMContentLoaded", () => {
    validTabs = Array.from(document.querySelectorAll('[role="tab"]'))
      .map((btn) => btn.dataset.tab)
      .filter(Boolean);

    const initialTab = validTabs.includes(activeTab) ? activeTab : validTabs[0];
    selectTab(initialTab, false);

    document.querySelectorAll('[role="tab"]').forEach((btn) => {
      btn.addEventListener("click", () => selectTab(btn.dataset.tab));
    });
  });

  // Listen to hash changes (e.g. someone clicks <a href="#partners">)
  window.addEventListener("hashchange", () => {
    const newTab = window.location.hash.substring(1);
    if (validTabs.includes(newTab)) {
      selectTab(newTab, false); // don't rewrite hash again
    }
  });
</script>

<div class="w-full py-10">
  <div
    class="tabs flex flex-col sm:flex-row border-b border-gray-300"
    role="tablist"
  >
    {
      tabs.map(({ id, label, Icon }) => (
        <button
          class={buttonStyle}
          role="tab"
          data-tab={id}
          aria-selected="false"
          aria-controls={`panel-${id}`}
          type="button"
          id={`tab-${id}`}
        >
          <Icon class="w-8 h-8 mb-1" />
          {label}
        </button>
      ))
    }
  </div>
</div>

{
  tabs.map(({ id, Content }) => (
    <div
      id={`panel-${id}`}
      class="tab-content hidden"
      role="tabpanel"
      aria-labelledby={`tab-${id}`}
    >
      <Content />
    </div>
  ))
}
